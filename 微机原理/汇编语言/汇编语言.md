# 汇编语言

## 一般结构

- 完整的程序由代码段、数据段和程序段组成
- 语句：段由语句组成
	- 指令语句：上一章
	- 伪指令语句：`[名字] 伪指令符 参数`对汇编的命令语句，一般没有对应目标代码
	- 宏指令语句：预定义的代码序列，定义后可重用
- 数据
	- 常量
		- 数值
		- 字符串
		- 符号：`AB EQU 3`
	- 变量：`[变量名] 伪指令 表达式 [,表达式 ···]`
		- 用变量名直接寻址必须满足目的寄存器位数
		- 合成运算符 `PTR` 可以变量类型转换：`MOV CX, WORD PTR AB`
		- 三种属性
			- 段属性
			- 偏移属性
			- 类型属性：多少个字节
		- 表达式
			- 数值表达式
			- ?：不预置初始值
			- 字符串
- 标号：一种变量，用于 `JMP` 指令的跳转

### 运算符与表达式

- 算术运算符：`+-*/`
- 逻辑运算符：`AND/OR`，注意与写在指令最前面效果不同
- 关系运算符：`LT/GE...`
- 取值运算符：`TYPE` 类型字节长度，`LENGTH` 元素个数，`SIZE` 占用字节数，`SEG` 取段地址，`OFFSET` 取偏移，例 `TYPE VAR`
- 合成运算符：
	- `PTR` 用于强制类型转换，如 `WORD PTR VAR`
	- `THIS` 用于创建别名，如 `DNUM EQU THIS WORD\n NUM DB 1, 3, 5, 7`

### 伪指令

- 功能：编译期运行
- 符号定义伪指令
	- 赋值：`EQU`，不可重复定义
	- `=` ：赋值，可重复定义
	- 类型定义：`LABEL=EQU THIS`，使用方法也一样
	- 解除：`PURGE`，解除 `EQU`
- 数据定义伪指令：用来定义变量占用字节长度的，比如 `DB`
- 段定义伪指令
	- 定义指令：`段名 SEGMENT ... 段名 ENDS`
	- 说明指令：`ASSUME DS:DATA CS:CODE`
- 程序标题伪指令：`TITLE`，几乎没什么屁用
- 地址计数器与对准伪指令：`$`，获取当前正在被汇编的指令或数据的地址（编译期计算），可以做偏移，比如 `$ + 6`
- 对准伪指令：`ORG EXP`，在指定位置写数据；比如先 `ORG 20D` 再定义变量，变量写到 `20D` 地址处
- 基数控制伪指令：`.RADIX 16` 指定进制

### 系统功能调用

- `INT n`
- BIOS调用
- DOS调用：`MOV AH, m\n INT 21H`
	- `21H` 是一个系统软中断
	- 读 `AH` 的内容作为指令
	- `01H` 是读，`02H` 是写

## 宏指令

## 逻辑结构

- 顺序逻辑
- 分支逻辑
	- `CMP A, B` 后面可以接 `JC/HNC, JZ/JNZ, JE/JNE, JG/JGE, JL/JLE, JP/JNP, JO/JNO, JS/JNS`
	- `JC/JNC`：有进位、借位专业/无进位、借位转移

## 子程序

- 声明部分：声明参数、名称和调用的其它子程序
	- 定义：`NAME PROC [NEAR/FAR] ... RET\nNAME ENDP`
	- 特性
		- 子程序名也具有段属性，偏移地址属性和类型属性(FAR和NEAR(缺省))
		- NEAR类型为段内调用
		- FAR为段间调用
- 代码部分：保护现场、恢复现场
	- 调用：`CALL （PROCNAME）`
		- 将 `CALL` 的下一条指令的 EA 压栈
		- 将 IP 设置为子程序首地址 EA
	- 返回：`RET/RET n`
		- 段内返回：IP设为栈顶内容
		- 段间返回：IP设为栈顶内容，弹栈，CS设为栈顶内容
		- 返回的地址称为**断点**，是 `CALL` 下一条指令地址
		- `RET n`，堆栈传递子程序参数时，用于清楚堆栈中栈顶 n/2 个无用参数
	- 注意
		- `CALL/RET` 不影响标志位
		- 段内返回还是段间返回由PROC后面的类决定
	- 参数传递
		- 寄存器法：子程序开头保护现场 `PUSH AX`，结尾恢复现场 `POP AX`
		- 存储器法：用地址表传递参数
			- 本质：二级指针
			- 存储器开一个地址表存数据地址，程序内存地址表首地址
		- 堆栈法：先把n个参数压栈，在子程序中使用
			- 进入子程序后，读栈
			- 注意主程序中压栈的最后一个参数不在栈顶
	- 现场保护与恢复
		- 都在子程序内部
		- 保护现场：将寄存器内容压栈的过程
		- 恢复现场：将寄存器内容弹栈的过程
		- 既可以在调用程序中进行，也可以在子程序中进行
- 子程序设计
	- 