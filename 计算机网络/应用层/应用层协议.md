---

mindmap-plugin: basic

---

# 应用层协议

## Web 和 HTTP

### 简述

- HTTP
	- 概念：应用层协议，Web 核心
	- 程序分类：客户机程序、服务器程序
	- 功能：规定了报文格式和交换报文的方式
	- 无状态协议：不保存客户机任何信息
	- 底层运输协议：TCP
	- 工作过程：创建 TCP 连接、交换报文（进程通过套接字访问 TCP）、关闭 TCP 连接
- Web 概念
	- Web 页：若干对象组成
	- 对象：文件
	- URL：统一资源定位符，存放对象服务器主机名和对象的路径名
	- 浏览器：用户代理，HTTP 协议的客户机端
	- Web 服务器：存储 Web 对象，服务器端

### HTTP 连接

- 三次握手
- 分类
	- 持续
		- 一个TCP连接上可以传送多个 Web 对象
		- 多个请求响应对
		- 超时未使用，服务器关闭连接
		- 方式
			- 流水线
				- 客户机连续产生请求
				- 服务器连续发送相应对象
				- 节省 RTT 时延
			- 非流水线
				- 客户机只能在前一个响应接收到之后才能发出新的请求
				- 一个对象一个 RTT 时延
	- 非持续
		- 每个 TCP 连接上只传送一个 Web 对象
		- 一个请求响应对
		- 往返时延 RTT：从客户机请求基本HTML文件开始，到用户收到整个文件为止所花时间
		- 可同时打开多个连接
			- 并行
			- 串行
		- 缺点
			- 服务器负担重：每一个请求对象建立和维护一个新的连接
			- 每一个对象的传输时延长：包含两个RTT时延，一个用于TCP建立， 一个用于请求和接收对象

### HTTP 报文格式

- 请求：请求行+首部行+实体主体
- 响应：状态行+首部行+实体主体
	- 状态码
		- 200 OK
		- 301
		- 400
		- 404
		- 505

### Cookie

- 前提：HTTP 服务无状态
- 功能：服务器跟踪、识别用户
- 工作过程：先 set，再用
- 划分
	- 在响应报文有 cookie 首部行
	- 在请求报文有 cookie 首部行
	- 用户主机保留一个 cookie 由浏览器管理
	- Web 站点后端数据库保存 cookie
- 用途
	- 鉴权
	- 会话状态

### 网络应用程序体系结构

- 客户机/服务器
	- 服务器
		- 为多个客户机提供服务
		- 总是打开
		- 永久 IP
		- 可扩展为集群
	- 客户机
		- 向服务器发送请求
		- 无需总是打开
		- 动态 IP
		- 彼此之间不能直接通信
- 对等 P2P
	- 无打开的服务器
	- 端系统直接通信
	- 间歇连接，动态 IP
- 客户机/服务器与 P2P 的混合
	- 服务器用于追踪用户的 IP

### 网络进程通信

- 进程：在主机上运行的程序
	- 不同主机间方法：网络交换报文
- web 应用
	- 客户机进程
	- 服务器进程
	- P2P 的应用程序既是服务器进程又是客户机进程
- 套接字
	- 概念：应用层与运输层之间的接口（应用程序接口 API），是可编程接口
	- 与进程关系：进程通过套接字在网络上收发报文
	- 套接字可以控制应用层的全部
	- 套接字几乎不能控制运输层
	- 套接字选择运输层协议
- 进程寻址
	- 功能：确定主机、确定进程
	- 主机名称：IP 地址
	- 进程标识：端口号
	- 网络应用程序端口不能重复
- 用户代理
	- 用户与网络应用程序之间的接口
	- 比如具体浏览器软件，电子邮件软件

### 协议

- 进程间传递报文的格式和方式
- 内容
	- 交换的报文类型
	- 报文类型的语法
	- 字段的语义
	- 进程何时、如何发送报文，如何响应
- 分类
	- 公共领域协议：RFC 定义
	- 专用层协议：具体应用的自定义协议

### 服务

- 应用程序间通信
	- 使用运输层协议提供的服务
	- 可靠数据传输：是否容忍数据丢失
	- 带宽要求
	- 超时限制
- TCP
	- 不适合实施应用
	- 面向连接的服务
		- 建立连接：两个套接字之间建立 TCP 连接
		- 传输报文：全双工
		- 拆除连接
	- 可靠传输服务
		- 无差错
		- 按适当顺序
		- 无丢失和重复
	- 拥塞控制：控制发送速率
- UDP
	- 无连接
	- 不可靠传输
	- 无拥塞控制
	- 无时延保证
	- 适用于实时应用