# 容斥原理

## 写在前面

之前的计数问题的一个显著特点就是在互斥的问题中计数，或者说我们遇到的问题都满足加法原理。但是现实中大多数问题通常不会这么简单，而通常需要考虑相交的问题的计数方法，其中一种就是容斥原理。

容斥原理的本质不难理解，其实它就是求一系列相交问题的并的解法。它的思想相当朴素，就是逐个问题求并并剔除重复部分的普遍规律。

## 容斥原理的推导

先从简单的情形开始考虑，即两个相交问题的并，任意问题可以被满足某些性质的集合描述。令 $A_1$ 为 $S$ 中具有性质 $P_1$ 的元素构成的子集，$A_2$ 为 $S$ 中具有性质 $P_2$ 的元素构成的子集，现考虑一个既不具有 $P_1$ 又不具有 $P_2$ 性质的子集。

显然，我们可以把 $A_1$ 和 $A_2$ 相加再**剔除其中的重复部分** $|A_1\cap A_2|$，得到 $|A_1 \cup A_2|$，除了这部分的余下部分即为所求。

$$
|\bar A_1 \cap \bar A_2| = S - |A_1| - |A_2| + |A_1 \cup A_2|
$$

继续推广到三个问题相交的情形，这时画个 $Venn$ 图将是有益的。

![OIP-C.jpg](http://image.tjzfile.xyz/images/2022/11/05/OIP-C.jpg)

$$
|\bar A\cap \bar B\cap \bar C| = S - |A| - |B| - |C| + |A\cap C| + |A\cap B| + |B\cap C| - |A\cap B\cap C|
$$

继续推广，可以归纳得到容斥原理的一般形式

$$
\begin{aligned}
|\bar A_1 \cap \bar A_2\cap \cdots\cap \bar A_m| =& S - \sum_{i\le m}| A_i| + \sum_{i\neq j}|A_i\cap A_j|-\sum_{i\neq j\neq k}|A_i\cap A_j \cap A_k|\\&+\cdots + (-1)^m|A_1\cap A_2\cap\cdots\cap A_m|
\end{aligned}
$$

关于每项的个数，可以简单地计数得到具有 $k$ 个交问题的和式有 $\binom{m}{k}$ 个项，比如 $\sum_{i\neq j\neq k}|A_i\cap A_j \cap A_k|$ 就有 $\binom{m}{3}$ 个项。

## 例题

### 一

![Screenshot-from-2022-11-05-23-56-44.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-56-44.png)
![Screenshot-from-2022-11-05-23-58-00.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-58-00.png)

### 二

![Screenshot-from-2022-11-05-23-58-12.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-58-12.png)
![Screenshot-from-2022-11-05-23-58-21.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-58-21.png)
![Screenshot-from-2022-11-05-23-58-27.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-58-27.png)
![Screenshot-from-2022-11-05-23-58-35.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-58-35.png)

### 三

* 如何定义和划分子问题是相当重要的，定义好后就可以用容斥原理求。

首先给出容斥原理的一个特例，考虑所有相交子问题的集合大小都是一样的情况，即存在 $\{\alpha_i\}_{i = 0}^{m}$，使得

$$
\alpha_0 = |S|\\
\alpha_1 = |A_1| = |A_2| = \cdots = |A_m|\\
\alpha_2 = |A_1\cap A_2| = \cdots = |A_{m - 1}\cap A_m|\\
\cdots\\
\alpha_m = |A_1\cap A_2\cap \cdots \cap A_m|
$$

那么容斥原理可写作

$$
|\bar A_1\cap \bar A_2\cap \cdots\cap \bar A_m| = \sum_{i = 0}^m(-1)^i\binom{m}{i}\alpha_i
$$

![Screenshot-from-2022-11-05-23-59-59.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-05-23-59-59.png)
![Screenshot-from-2022-11-06-00-00-06.png](http://image.tjzfile.xyz/images/2022/11/05/Screenshot-from-2022-11-06-00-00-06.png)
