# Catalan 数

## 写在前面

Catalan 数不是一个什么有严格数学意义的数列，它纯粹是因为对应许多应用问题的解而得到记录。但是，一般来说 Catalan 数有一个有趣的特性——它似乎递归的联系十分紧密。许多限制条件类似的有递归定义的问题的解都是 Catalan 数。

所以，这里就直接给出 Catalan 数的通项公式和递推公式吧。

* 通项公式

$$
C_n = \binom{2n + 1}{n}/(2n + 1) = \binom{2n}{n}/(n + 1)
$$

* 递推公式

$$
C_n = \sum_{k = 1}^{n - 1}C_kC_{n - k}
$$

$$
C_{n + 1} = \dfrac{2(2n+1)}{(n+2)}Cn
$$

## 合法括号序列问题

* 长为 $2n$ 的合法括号序列的个数有多少个？所谓合法，意味着这个序列每对括号都匹配。

我们需要对问题做一些转化，不妨将一个括号序列看作一个有 $n$ 个 $1$, $n$ 个 $-1$（左、右括号） 的序列。对于一个合法的序列，这个序列的任意前缀和显然是非负的。

利用非负这个性质，我们可以从所有可能的序列中剔除那些不合法的序列。我们考虑向一个空序列中逐个添加元素的过程，为方便讨论，先假设当前序列中 $1$ 的个数为 $x$，而 $-1$ 的个数为 $y$。

考虑每次在一个序列末尾放入一个数 $-1$ 或 $1$，那么放入该数后必须存在 $x \ge y$ 才能构成合法序列。这个问题直接去想还是有一定难度，我们还需要进行恰当的转换。

考虑路径计数问题，从左下角 $(0, 0)$ 出发，走到右上角 $(n, n)$，每次只能往右或往上走，而且往右走的次数必须大于等于往上走的次数。那么问题如下

![Screenshot-from-2022-12-07-21-45-30.png](http://image.tjzfile.xyz/images/2022/12/07/Screenshot-from-2022-12-07-21-45-3意味着0.png)

> 注：红线显然意味着 $x \ge y$。

### 另寻他路

还有一种推导的思路，需要用到一个定理，但是它不是那么显然。

* Raney 引理：设 $H=(h_1, \cdots, h_L)$ 是一个整数序列，满足 $\sum_{k = 1}^Lh_k = 1$，那么在 $H$ 的 $L$ 个循环位移中恰有一个的所有前缀和为正。

所谓循环位移，就是一个排列在经过有限次循环的移位操作后的序列，比如，排列 $\{1, 2, 3\}$ 的循环位移 $\{1, 2, 3\}$，$\{2, 3, 1\}$, $\{3, 1, 2\}$，有三个。

我们沿用上面的一个变化过的原问题的形式

> 不妨将一个括号序列看作一个有 $n$ 个 $1$, $n$ 个 $-1$（左、右括号） 的序列。对于一个合法的序列，这个序列的任意前缀和显然是非负的。

实际上，该问题等价于

> 假设一个有 $n + 1$ 个 $1$, $n$ 个 $-1$（左、右括号） 的序列。对于一个合法的序列，这个序列的任意前缀和是正的。

或者说，把序列第一个元素固定为 $1$，得到一个扩展的等价问题（前两个元素都必须是 $1$）。

这个新问题就有 Raney 引理的形式（所有元素和为 $1$），所以我们可以简单地得出，对于 $n + 1$ 个 $1$ 和 $n$ 个 $-1$ 的排列问题中，所有前缀和都为正的（合法）序列个数。

所有排列的总数为

$$
\binom{2n + 1}{n}
$$

同时，我们考虑一组循环同构（经过有限次循环移位可以得到相同序列的一组序列）的循环位移，每组有 $2n + 1$ 个（证明略），那么在这组里只有一个的任意前缀和都为正。

于是合法序列个数为

$$
\binom{2n + 1}{n} / (2n + 1)
$$

经过简单的数学推导，不难发现

$$
\binom{2n + 1}{n} / (2n + 1) = \binom{2n}{n} / (n + 1)
$$

定义它为 Catalan 数，记为 $C_n$。

## 凸 n 边形三角剖分的个数

* 将一个凸 $n$ 边形划分成不重叠的 $n - 2$ 个三角形，共有多少种划分方法？

通过这个例子，我们将推导出 Catalan 数的递推定义，并对 Catalan 数中蕴含的有趣的递归性质进行一些探讨。

必须指出，这个问题存在等价的规模更小的子问题，也就是说，任意一个凸多边形的三角剖分问题，可以归约到边数比它少的几个多边形的三角剖分问题上，我们说这样的问题存在**递归定义**。

具体地说，当我们在一个凸多边形中连接任意两个顶点时，这个凸多边形的三角剖分问题都可以归约为它划分出的两个小凸多边形的三角剖分之和。而在一个凸 $n$ 边形中，互不相同的这样的划分有 $n - 3$ 个（固定一个端点，另一点任意连），设 $F(n)$ 表示 $n + 2$ 边形分解的方案，则

$$
F(n) = F(0)F(n - 1) + F(1)F(n - 2) + \cdots + F(n - 1)F(0)
$$

其中 $F(0) = 1$。

实际上 $F(n)$ 就是 Catalan 数 $C_n$，这里我们不直接证明它而是通过继续变换上一个例子来得出上式的形式。

将原问题划分成互斥的子集：当第一个与首个左括号匹配的括号在位置 $2,3,\cdots,n$ 处的子问题（即第一对括号的右括号的位置）。

对于每一个这样的子问题，我们在接着考虑**第一对括号中的子问题和第一对括号外的子问题**，依次递归下去。

假设 $n$ 个括号的合法序列有 $H(n)$ 个，这样就有

$$
C_n = H(n) = H(0)H(n - 1) + H(1)H(n - 2) + \cdots + H(n - 1)H(0)
$$

显然 $H(0) = 1$。