# 关系数据库设计

## 函数依赖

- 定义：属性 $\alpha\rightarrow\beta\in R\Leftrightarrow$ 任意 $R$ 的实例 $r$ 中的任意两行 $t_1, t_2$ 都满足 $t_1[\alpha]=t_2[\alpha]\Rightarrow t_1[\beta]=t_2[\beta]$
	- 如果 $\beta\subseteq \alpha$，那么 $\alpha\rightarrow\beta$ 是平凡的（trival），否则是非平凡（non-trival）的
	- $\alpha\rightarrow R$ 也可以存在
	- 超码、候选码可以用该概念定义
	- 函数依赖必须对所有合法数据成立：某个时刻表的数据可能满足某函数依赖，但该函数依赖不一定对所有合法数据成立
- 函数依赖集：若干个函数依赖的集合
	- 关系 $r$ 满足依赖集 $F$
	- 关系模式 $R$ 满足依赖集 $R$：$R$ 的所有关系 $r$ 都满足

## 闭包

- 属性集的闭包
	- 定义：$\alpha^+ = \{\beta\vert\alpha\rightarrow\beta\}$，根据函数依赖集 $F$，由属性 $\alpha$ 可推断出的所有属性所组成的集合
	- 算法：图图
	- 特性
		- 判断属性集是否超码：$R\subseteq \alpha^+$ 则 $\alpha$ 是超码
		- 判断函数依赖是否成立：$\beta\subseteq\alpha^+$ 是否成立
		- 简化计算函数依赖集
- 函数依赖集的闭包
	- 定义：由函数依赖集 $F$ 可推断出的所有**函数依赖所组成的集合**，记作 $F^+$。（属性集是属性组成的集合）
	- 特性
		- $A\rightarrow B, B\rightarrow C\Rightarrow A\rightarrow C$
		- $F\subseteq F^+$
	- 计算闭包
		- Armstrong公理
			- 自反：$\beta\subseteq \alpha\Rightarrow \alpha\rightarrow\beta$
			- 增广：$\alpha\rightarrow \beta\Rightarrow\gamma\alpha\rightarrow\gamma\beta$
			- 传递：$\alpha\rightarrow\beta,\beta\rightarrow\gamma\Rightarrow \alpha\rightarrow\gamma$
			- 合并：$\alpha\rightarrow\beta,\alpha\rightarrow\beta\gamma\Rightarrow \alpha\rightarrow\beta\gamma$
			- 分解：$\alpha\rightarrow\beta\gamma\Rightarrow\alpha\rightarrow\beta, \alpha\rightarrow\gamma$
			- 伪传递：$\alpha\rightarrow\beta, \gamma\beta\rightarrow\sigma\Rightarrow\alpha\gamma\rightarrow\sigma$
		- 利用属性集的闭包
			- 对关系模式 $R$ 的每一个子集 $S$：为 $S^+$ 的每一个子集 $T$，输出函数依赖 $S\rightarrow T$
	- 等价关系
		- 定义：$F_1,F_2$ 能够互相推导
		- $F_1=F_2\Leftrightarrow F_1^+ = F_2^+$
	- 最小覆盖：函数依赖集的最小形式 $F_C$
		- 定义
			- $F,F_C$ 等价
			- $F_C$ 的所有函数依赖都没有多余属性
			- $F_C$ 的每个函数依赖的左式都唯一
		- 算法：图图
	- 模式分解：设 $R_1,R_2$ 是 $R$ 的分解（子集），$r$ 是任意关系
		- 无损分解：$R_1\cap R_2\rightarrow R_1$ 或 $R_1\cap R_2\rightarrow R_2$
		- 保持函数依赖：$F^+$ 中「只包含 $R$ 的某分解中的任意分解」的子集的并集与 $F$ 等价，则该「$R$ 的分解」保持函数依赖

## 范式

- 1NF第一范式
	- 定义：关系模式 $R$ 的所有属性域都是原子域
	- 原子：既不是复合属性（属性包含多个子属性）又不是多值属性（属性取值是一个元组）
- 3NF第三范式
	- 定义：如果 $F^+$ 里任意函数依赖 $\alpha\rightarrow\beta(\alpha\cap\beta\neq 0)$ 满足以下之一
		- 函数依赖是平凡的
		- 函数依赖是不平凡的，且以下任意一个成立
			- $\alpha$ 是 $R$ 的超码
			- $\beta$ 的每个属性都包含在一个候选码中
	- 算法：找到所有候选码，然后只用判断 $F$ 中的函数依赖满足上述两点至少其一
	- 特性：能保持函数依赖，有一定冗余
- BCNF BC范式
	- 定义：如果 $F^+$ 里任意非平凡函数依赖 $\alpha\rightarrow\beta(\alpha\cap\beta\neq 0)$ 满足以条件
		- $\alpha$ 是 $R$ 的超码
		- （没有第二条: )
	- 算法与3NF完全类似
	- 特性：不能保持函数依赖，完全消除冗余
- 目标
	- BCNF
	- 无损分解
	- 保持函数依赖

## 关系分解

- 无损分解
- 3NF分解
	- 求出F的最小覆盖Fc（去掉多余函数依赖和函数依赖的多余属性）
	- 为Fc的每个函数依赖 $\alpha\rightarrow \beta$ 生成一个新的关系模式 $\alpha\cup\beta$
	- 如果生成的每个关系模式都不包含R的候选码，就选择R的任意一个候选码A，生成一个新的关系模式A
	- 检查生成的关系模式，如果有$R_1\subseteq R_2$，就把R1删掉
- BCNF分解
	- 假设R有一个非平凡函数依赖 $\alpha\rightarrow\beta$
	- 如果 $\alpha$ 不是超码，把R分解成 $\alpha\cup\beta, R-\beta$
	- 递归分解，直到都是BCNF